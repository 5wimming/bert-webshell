# -*- coding: utf-8 -*-
'''
@author: yaleimeng@sina.com
@license: (C) Copyright 2019
@desc: 这个代码是进行预测的。既可以根据ckpt检查点，也可以根据单个pb模型。
@DateTime: Created on 2019/7/19, at 下午 04:13 by PyCharm
'''
import os
from train_eval import *
from tensorflow.python.estimator.model_fn import EstimatorSpec
import warnings

warnings.filterwarnings("ignore")
os.environ['CUDA_VISIBLE_DEVICES'] = '1'

class Bert_Class():

    def __init__(self):
        self.graph_path = os.path.join(arg_dic['pb_model_dir'], 'classification_model.pb')
        self.ckpt_tool, self.pbTool = None, None
        self.prepare()

    def classification_model_fn(self, features, mode):
        with tf.gfile.GFile(self.graph_path, 'rb') as f:
            graph_def = tf.GraphDef()
            graph_def.ParseFromString(f.read())
        input_ids = features["input_ids"]
        input_mask = features["input_mask"]
        input_map = {"input_ids": input_ids, "input_mask": input_mask}
        pred_probs = tf.import_graph_def(graph_def, name='', input_map=input_map, return_elements=['pred_prob:0'])

        return EstimatorSpec(mode=mode, predictions={
            'encodes': tf.argmax(pred_probs[0], axis=-1),
            'score': tf.reduce_max(pred_probs[0], axis=-1)})

    def prepare(self):
        tokenization.validate_case_matches_checkpoint(arg_dic['do_lower_case'], arg_dic['init_checkpoint'])
        self.config = modeling.BertConfig.from_json_file(arg_dic['bert_config_file'])

        if arg_dic['max_seq_length'] > self.config.max_position_embeddings:
            raise ValueError(
                "Cannot use sequence length %d because the BERT model "
                "was only trained up to sequence length %d" %
                (arg_dic['max_seq_length'], self.config.max_position_embeddings))

        # tf.gfile.MakeDirs(self.out_dir)
        self.tokenizer = tokenization.FullTokenizer(vocab_file=arg_dic['vocab_file'],
                                                    do_lower_case=arg_dic['do_lower_case'])

        self.processor = SelfProcessor()
        self.train_examples = self.processor.get_train_examples(arg_dic['data_dir'])
        global label_list
        label_list = self.processor.get_labels()

        self.run_config = tf.estimator.RunConfig(
            model_dir=arg_dic['output_dir'], save_checkpoints_steps=arg_dic['save_checkpoints_steps'],
            tf_random_seed=None, save_summary_steps=100, session_config=None, keep_checkpoint_max=5,
            keep_checkpoint_every_n_hours=10000, log_step_count_steps=100, )

    def predict_on_ckpt(self, sentence):
        if not self.ckpt_tool:
            num_train_steps = int(len(self.train_examples) / arg_dic['train_batch_size'] * arg_dic['num_train_epochs'])
            num_warmup_steps = int(num_train_steps * arg_dic['warmup_proportion'])

            model_fn = model_fn_builder(bert_config=self.config, num_labels=len(label_list),
                                        init_checkpoint=arg_dic['init_checkpoint'], learning_rate=arg_dic['learning_rate'],
                                        num_train=num_train_steps, num_warmup=num_warmup_steps)

            self.ckpt_tool = tf.estimator.Estimator(model_fn=model_fn, config=self.run_config, )
        exam = self.processor.one_example(sentence)  # 待预测的样本列表
        feature = convert_single_example(0, exam, label_list, arg_dic['max_seq_length'], self.tokenizer)

        predict_input_fn = input_fn_builder(features=[feature, ],
                                            seq_length=arg_dic['max_seq_length'], is_training=False,
                                            drop_remainder=False)
        result = self.ckpt_tool.predict(input_fn=predict_input_fn)  # 执行预测操作，得到一个生成器。
        gailv = list(result)[0]["probabilities"].tolist()
        print(label_list)
        print(gailv)
        pos = gailv.index(max(gailv))  # 定位到最大概率值索引，
        return label_list[pos]

    def predict_on_pb(self, sentence):
        if not self.pbTool:
            self.pbTool = tf.estimator.Estimator(model_fn=self.classification_model_fn, config=self.run_config, )
        exam = self.processor.one_example(sentence)  # 待预测的样本列表
        feature = convert_single_example(0, exam, label_list, arg_dic['max_seq_length'], self.tokenizer)
        predict_input_fn = input_fn_builder(features=[feature, ],
                                            seq_length=arg_dic['max_seq_length'], is_training=False,
                                            drop_remainder=False)
        result = self.pbTool.predict(input_fn=predict_input_fn)  # 执行预测操作，得到一个生成器。
        ele = list(result)[0]
        print('类别：{}，置信度：{:.3f}'.format(label_list[ele['encodes']], ele['score']))
        return label_list[ele['encodes']]


if __name__ == "__main__":
    warnings.filterwarnings("ignore")
    import time

    testcase = ['Consumer,import org springframework integration support MessageBuilder,import org springframework messaging Message,import org springframework messaging MessageChannel,import org springframework messaging MessageDeliveryException,import org springframework messaging MessageHandler,import org springframework messaging MessagingException,import org springframework messaging SubscribableChannel,import org springframework util Assert,import org springframework yarn am AppmasterService,import org springframework yarn am GenericRpcMessage,import org springframework yarn am RpcMessage,import org springframework yarn integration support IntegrationObjectSupport,import org springframework yarn integration support PortExposingTcpSocketSupport,public abstract class IntegrationAppmasterService extends IntegrationObjectSupport implements AppmasterService,private static final Log log,LogFactory getLog,IntegrationAppmasterService class,private PortExposingTcpSocketSupport socketSupport,private SubscribableChannel messageChannel,private final MessagingTemplate messagingTemplate,new MessagingTemplate,private EventDrivenConsumer consumer,protected void doStart,,this consumer,new EventDrivenConsumer,this messageChannel,new IntegrationAppmasterService ReplyProducingHandler,IntegrationAppmasterService NamelessClass2016530858,null,this consumer start,protected void doStop,,if,this consumer,null,,this consumer stop,public int getPort,,return this socketSupport,null?this socketSupport getServerSocketPort,:,1,public String getHost,,return this socketSupport,null?this socketSupport getServerSocketAddress,:null,public boolean hasPort,,return true,public abstract RpcMessage handleMessageInternal,RpcMessage var1,public void setMessageChannel,SubscribableChannel messageChannel,,Assert notNull,messageChannel,"messageChannel must not be null",this messageChannel,messageChannel,public void setSocketSupport,PortExposingTcpSocketSupport socketSupport,,Assert notNull,socketSupport,"socketSupport must not be null",this socketSupport,socketSupport,if,log isDebugEnabled,,log debug,"Setting socket support: ",socketSupport,private void sendMessage,Message message,Object channel,,if,channel instanceof MessageChannel,,this messagingTemplate send,MessageChannel,channel,message,else,if,channel instanceof String,,throw new MessageDeliveryException,message,"a non,null reply channel value of type MessageChannel or String is required",this messagingTemplate send,String,channel,message,static class NamelessClass2016530858,private class ReplyProducingHandler implements MessageHandler,private ReplyProducingHandler,,public void handleMessage,Message message,throws MessagingException,GenericRpcMessage incoming,new GenericRpcMessage,message getPayload,RpcMessage outgoing,IntegrationAppmasterService this handleMessageInternal,incoming,Message reply,MessageBuilder withPayload,outgoing getBody, build,IntegrationAppmasterService this sendMessage,reply,message getHeaders, getReplyChannel,ReplyProducingHandler,IntegrationAppmasterService NamelessClass2016530858 x1,,this,', 
        ',jsp File browser 1 1a,Copyright,C,2003,2004,Boris von Loesch,This program is free software,you can redistribute it and,or modify it under,the terms of the GNU General Public License as published by the,Free Software Foundation,either version 2 of the License,or,at your option,any later version ,This program is distributed in the hope that it will be useful,but,WITHOUT ANY WARRANTY,without even the implied warranty of MERCHANTABILITY or,FITNESS FOR A PARTICULAR PURPOSE See the GNU General Public License for more details ,You should have received a copy of the GNU General Public License along with,this program,if not,write to the,Free Software Foundation,Inc ,59 Temple Place,Suite 330,Boston,MA 02111,1307 USA,Description: jsp File browser v1 1a,This JSP program allows remote web,based,file access and manipulation  You can copy,create,move and delete files ,Text files can be edited and groups of files and folders can be downloaded,as a single zip file thats created on the fly ,Credits: Taylor Bastien,David Levine,David Cowan,Lieven Govaerts,@page import,"java util ,java net ,java text ,java util zip ,java io ,",private static final boolean NATIVE_COMMANDS,true,private static final boolean RESTRICT_BROWSING,false,private static final boolean RESTRICT_WHITELIST,false,private static final String RESTRICT_PATH,",etc,var",private static final int UPLOAD_MONITOR_REFRESH,2,private static final int EDITFIELD_COLS,85,private static final int EDITFIELD_ROWS,30,private static final boolean USE_POPUP,true,private static final boolean USE_DIR_PREVIEW,true,private static final int DIR_PREVIEW_NUMBER,10,private static final String CSS_NAME,"Browser css",private static final int COMPRESSION_LEVEL,1,private static final String,FORBIDDEN_DRIVES,,"a:,",private static final String,COMMAND_INTERPRETER,,"cmd",",C",private static final long MAX_PROCESS_RUNNING_TIME,30,1000,private static final String SAVE_AS_ZIP,"Download selected files as zip",private static final String RENAME_FILE,"Rename File",private static final String DELETE_FILES,"Delete selected files",private static final String CREATE_DIR,"Create Dir",private static final String CREATE_FILE,"Create File",private static final String MOVE_FILES,"Move Files",private static final String COPY_FILES,"Copy Files",private static String tempdir," ",private static String VERSION_NR,"1 1a",private static DateFormat dateFormat,DateFormat getDateTimeInstance,public class UplInfo,public long totalSize,public long currSize,public long starttime,public boolean aborted,public UplInfo,,totalSize,0l,currSize,0l,starttime,System currentTimeMillis,aborted,false,public UplInfo,int size,,totalSize,size,currSize,0,starttime,System currentTimeMillis,aborted,false,public String getUprate,,long time,System currentTimeMillis,,starttime,if,time,0,,long uprate,currSize,1000,time,return convertFileSize,uprate,,",s",else return "n,a",public int getPercent,,if,totalSize,0,return 0,else return,int,,currSize,100,totalSize,public String getTimeElapsed,,long time,,System currentTimeMillis,,starttime,,1000l,if,time,60l,0,if,time,60,10,return time,60,":",,time,60,,"m",else return time,60,":0",,time,60,,"m",else return time,10 ? "0",time,"s": time,"s",public String getTimeEstimated,,if,currSize,0,return "n,a",long time,System currentTimeMillis,,starttime,time,totalSize,time,currSize,time,1000l,if,time,60l,0,if,time,60,10,return time,60,":",,time,60,,"m",else return time,60,":0",,time,60,,"m",else return time,10 ? "0",time,"s": time,"s",public class FileInfo,public String name,null,clientFileName,null,fileContentType,null,private byte,fileContents,null,public File file,null,public StringBuffer sb,new StringBuffer,100,public void setFileContents,byte,aByteArray,,fileContents,new byte,aByteArray length,System arraycopy,aByteArray,0,fileContents,0,aByteArray length,public static class UploadMonitor,static Hashtable uploadTable,new Hashtable,static void set,String fName,UplInfo info,,uploadTable put,fName,info,static void remove,String fName,,uploadTable remove,fName,static UplInfo getInfo,String fName,,UplInfo info,,UplInfo,uploadTable get,fName,return info,public class HttpMultiPartParser,private final String lineSeparator,System getProperty,"line separator",",n",private final int ONE_MB,1024,1,public Hashtable processData,ServletInputStream is,String boundary,String saveInDir,int clength,throws IllegalArgumentException,IOException,if,is,null,throw new IllegalArgumentException,"InputStream",if,boundary,null,boundary trim, length,,1,throw new IllegalArgumentException,","",boundary,"," is an illegal boundary indicator",boundary,",",boundary,StringTokenizer stLine,null,stFields,null,FileInfo fileInfo,null,Hashtable dataTable,new Hashtable,5,String line,null,field,null,paramName,null,boolean saveFiles,,saveInDir,null,saveInDir trim, length,,0,boolean isFile,false,if,saveFiles,,File f,new File,saveInDir,f mkdirs,line,getLine,is,if,line,null,,line startsWith,boundary,throw new IOException,"Boundary not found,boundary,",boundary,",line,",line,while,line,null,,if,line,null,,line startsWith,boundary,return dataTable,line,getLine,is,if,line,null,return dataTable,stLine,new StringTokenizer,line,",r,n",if,stLine countTokens,,2,throw new IllegalArgumentException,"Bad data in second line",line,stLine nextToken, toLowerCase,if,line indexOf,"form,data",,0,throw new IllegalArgumentException,"Bad data in second line",stFields,new StringTokenizer,stLine nextToken,","",if,stFields countTokens,,2,throw new IllegalArgumentException,"Bad data in second line",fileInfo,new FileInfo,stFields nextToken,paramName,stFields nextToken,isFile,false,if,stLine hasMoreTokens,,field,stLine nextToken,stFields,new StringTokenizer,field,","",if,stFields countTokens,,1,,if,stFields nextToken, trim, equalsIgnoreCase,"filename",,fileInfo name,paramName,String value,stFields nextToken,if,value,null,value trim, length,,0,,fileInfo clientFileName,value,isFile,true,else,line,getLine,is,line,getLine,is,line,getLine,is,line,getLine,is,continue,else if,field toLowerCase, indexOf,"filename",,0,,line,getLine,is,line,getLine,is,line,getLine,is,line,getLine,is,continue,boolean skipBlankLine,true,if,isFile,,line,getLine,is,if,line,null,return dataTable,if,line trim, length,,1,skipBlankLine,false,else,stLine,new StringTokenizer,line,": ",if,stLine countTokens,,2,throw new IllegalArgumentException,"Bad data in third line",stLine nextToken,fileInfo fileContentType,stLine nextToken,if,skipBlankLine,,line,getLine,is,if,line,null,return dataTable,if,isFile,,line,getLine,is,if,line,null,return dataTable,dataTable put,paramName,line,if,paramName equals,"dir",saveInDir,line,line,getLine,is,continue,try,UplInfo uplInfo,new UplInfo,clength,UploadMonitor set,fileInfo clientFileName,uplInfo,OutputStream os,null,String path,null,if,saveFiles,os,new FileOutputStream,path,getFileName,saveInDir,fileInfo clientFileName,else os,new ByteArrayOutputStream,ONE_MB,boolean readingContent,true,byte previousLine,,new byte,2,ONE_MB,byte temp,,null,byte currentLine,,new byte,2,ONE_MB,int read,read3,if,read,is readLine,previousLine,0,previousLine length,,,1,,line,null,break,while,readingContent,,if,read3,is readLine,currentLine,0,currentLine length,,,1,,line,null,uplInfo aborted,true,break,if,compareBoundary,boundary,currentLine,,os write,previousLine,0,read,2,line,new String,currentLine,0,read3,break,else,os write,previousLine,0,read,uplInfo currSize,read,temp,currentLine,currentLine,previousLine,previousLine,temp,read,read3,os flush,os close,if,saveFiles,,ByteArrayOutputStream baos,,ByteArrayOutputStream,os,fileInfo setFileContents,baos toByteArray,else fileInfo file,new File,path,dataTable put,paramName,fileInfo,uplInfo currSize,uplInfo totalSize,catch,IOException e,,throw e,return dataTable,private boolean compareBoundary,String boundary,byte ba,,byte b,if,boundary,null,ba,null,return false,for,int i,0,i,boundary length,i,if,byte,boundary charAt,i,,ba,i,return false,return true,private synchronized String getLine,ServletInputStream sis,throws IOException,byte b,,new byte,1024,int read,sis readLine,b,0,b length,index,String line,null,if,read,,1,,line,new String,b,0,read,if,index,line indexOf,,n,,0,line,line substring,0,index,1,return line,public String getFileName,String dir,String fileName,throws IllegalArgumentException,String path,null,if,dir,null,fileName,null,throw new IllegalArgumentException,"dir or fileName is null",int index,fileName lastIndexOf,,,String name,null,if,index,0,name,fileName substring,index,1,else name,fileName,index,name lastIndexOf,,,if,index,0,fileName,name substring,index,1,path,dir,File separator,fileName,if,File separatorChar,,,return path replace,,,File separatorChar,else return path replace,,,File separatorChar,class FileComp implements Comparator,int mode,int sign,FileComp,,this mode,1,this sign,1,FileComp,int mode,,if,mode,0,,this mode,,mode,sign,,1,else,this mode,mode,this sign,1,public int compare,Object o1,Object o2,,File f1,,File,o1,File f2,,File,o2,if,f1 isDirectory,,if,f2 isDirectory,,switch,mode,,case 1:,case 4:,return sign,f1 getAbsolutePath, toUpperCase, compareTo,f2 getAbsolutePath, toUpperCase,case 2:,return sign,,new Long,f1 length, compareTo,new Long,f2 length,case 3:,return sign,,new Long,f1 lastModified, compareTo,new Long,f2 lastModified,default:,return 1,else return,1,else if,f2 isDirectory,return 1,else,switch,mode,,case 1:,return sign,f1 getAbsolutePath, toUpperCase, compareTo,f2 getAbsolutePath, toUpperCase,case 2:,return sign,,new Long,f1 length, compareTo,new Long,f2 length,case 3:,return sign,,new Long,f1 lastModified, compareTo,new Long,f2 lastModified,case 4:,int tempIndexf1,f1 getAbsolutePath, lastIndexOf, ,int tempIndexf2,f2 getAbsolutePath, lastIndexOf, ,if,tempIndexf1,,1,,,tempIndexf2,,1,,return sign,f1 getAbsolutePath, toUpperCase, compareTo,f2 getAbsolutePath, toUpperCase,else if,tempIndexf1,,1,return,sign,else if,tempIndexf2,,1,return sign,else,String tempEndf1,f1 getAbsolutePath, toUpperCase, substring,tempIndexf1,String tempEndf2,f2 getAbsolutePath, toUpperCase, substring,tempIndexf2,return sign,tempEndf1 compareTo,tempEndf2,default:,return 1,class Writer2Stream extends OutputStream,Writer out,Writer2Stream,Writer w,,super,out,w,public void write,int i,throws IOException,out write,i,public void write,byte,b,throws IOException,for,int i,0,i,b length,i,,int n,b,i,n,,n,4,,0xF,,16,,n,0xF,out write,n,public void write,byte,b,int off,int len,throws IOException,for,int i,off,i,off,len,i,,int n,b,i,n,,n,4,,0xF,,16,,n,0xF,out write,n,static Vector expandFileList,String,files,boolean inclDirs,,Vector v,new Vector,if,files,null,return v,for,int i,0,i,files length,i,v add,new File,URLDecoder decode,files,i,for,int i,0,i,v size,i,,File f,,File,v get,i,if,f isDirectory,,File,fs,f listFiles,for,int n,0,n,fs length,n,v add,fs,n,if,inclDirs,,v remove,i,i,return v,static String getDir,String dir,String name,,if,dir endsWith,File separator,dir,dir,File separator,File mv,new File,name,String new_dir,null,if,mv isAbsolute,,new_dir,dir,name,else new_dir,name,return new_dir,static String convertFileSize,long size,,int divisor,1,String unit,"bytes",if,size,1024,1024,,divisor,1024,1024,unit,"MB",else if,size,1024,,divisor,1024,unit,"KB",if,divisor,1,return size,divisor," ",unit,String aftercomma,"",100,,size,divisor,,divisor,if,aftercomma length,,1,aftercomma,"0",aftercomma,return size,divisor," ",aftercomma," ",unit,static void copyStreams,InputStream in,OutputStream out,byte,buffer,throws IOException,copyStreamsWithoutClose,in,out,buffer,in close,out close,static void copyStreamsWithoutClose,InputStream in,OutputStream out,byte,buffer,throws IOException,int b,while,b,in read,buffer,,,1,out write,buffer,0,b,static String getMimeType,String fName,,fName,fName toLowerCase,if,fName endsWith," jpg",,fName endsWith," jpeg",,fName endsWith," jpe",return "image,jpeg",else if,fName endsWith," gif",return "image,gif",else if,fName endsWith," pdf",return "application,pdf",else if,fName endsWith," htm",,fName endsWith," html",,fName endsWith," shtml",return "text,html",else if,fName endsWith," avi",return "video,x,msvideo",else if,fName endsWith," mov",,fName endsWith," qt",return "video,quicktime",else if,fName endsWith," mpg",,fName endsWith," mpeg",,fName endsWith," mpe",return "video,mpeg",else if,fName endsWith," zip",return "application,zip",else if,fName endsWith," tiff",,fName endsWith," tif",return "image,tiff",else if,fName endsWith," rtf",return "application,rtf",else if,fName endsWith," mid",,fName endsWith," midi",return "audio,x,midi",else if,fName endsWith," xl",,fName endsWith," xls",,fName endsWith," xlv",fName endsWith," xla",,fName endsWith," xlb",,fName endsWith," xlt",fName endsWith," xlm",,fName endsWith," xlk",return "application,excel",else if,fName endsWith," doc",,fName endsWith," dot",return "application,msword",else if,fName endsWith," png",return "image,png",else if,fName endsWith," xml",return "text,xml",else if,fName endsWith," svg",return "image,svg,xml",else if,fName endsWith," mp3",return "audio,mp3",else if,fName endsWith," ogg",return "audio,ogg",else return "text,plain",static String conv2Html,int i,,if,i,,,return ",amp,",else if,i,,,return ",lt,",else if,i,,,return ",gt,",else if,i,",return ",quot,",else return "",,char,i,static String conv2Html,String st,,StringBuffer buf,new StringBuffer,for,int i,0,i,st length,i,,buf append,conv2Html,st charAt,i,return buf toString,static String startProcess,String command,String dir,throws IOException,StringBuffer ret,new StringBuffer,String,comm,new String,3,comm,0,,COMMAND_INTERPRETER,0,comm,1,,COMMAND_INTERPRETER,1,comm,2,,command,long start,System currentTimeMillis,try,Process ls_proc,Runtime getRuntime, exec,comm,null,new File,dir,BufferedInputStream ls_in,new BufferedInputStream,ls_proc getInputStream,BufferedInputStream ls_err,new BufferedInputStream,ls_proc getErrorStream,boolean end,false,while,end,,int c,0,while,ls_err available,,0,,,c,1000,,ret append,conv2Html,ls_err read,c,0,while,ls_in available,,0,,,c,1000,,ret append,conv2Html,ls_in read,try,ls_proc exitValue,while,ls_err available,,0,ret append,conv2Html,ls_err read,while,ls_in available,,0,ret append,conv2Html,ls_in read,end,true,catch,IllegalThreadStateException ex,,if,System currentTimeMillis,,start,MAX_PROCESS_RUNNING_TIME,,ls_proc destroy,end,true,ret append,",Process has timed out,destroyed,",try,Thread sleep,50,catch,InterruptedException ie,,catch,IOException e,,ret append,"Error: ",e,return ret toString,static String dir2linkdir,String dir,String browserLink,int sortMode,,File f,new File,dir,StringBuffer buf,new StringBuffer,while,f getParentFile,,null,,if,f canRead,,String encPath,URLEncoder encode,f getAbsolutePath,buf insert,0,",a href,"",browserLink,"?sort,",sortMode,",amp,dir,",encPath,",",",conv2Html,f getName,,File separator,",a,",else buf insert,0,conv2Html,f getName,,File separator,f,f getParentFile,if,f canRead,,String encPath,URLEncoder encode,f getAbsolutePath,buf insert,0,",a href,"",browserLink,"?sort,",sortMode,",amp,dir,",encPath,",",",conv2Html,f getAbsolutePath,,",a,",else buf insert,0,f getAbsolutePath,return buf toString,static boolean isPacked,String name,boolean gz,,return,name toLowerCase, endsWith," zip",,name toLowerCase, endsWith," jar",,gz,name toLowerCase, endsWith," gz",,name toLowerCase, endsWith," war",static boolean isAllowed,File path,throws IOException,if,RESTRICT_BROWSING,,StringTokenizer stk,new StringTokenizer,RESTRICT_PATH,",",while,stk hasMoreTokens,if,path,null,path getCanonicalPath, startsWith,stk nextToken,return RESTRICT_WHITELIST,return,RESTRICT_WHITELIST,else return true,request setAttribute,"dir",request getParameter,"dir",final String browser_name,request getRequestURI,final String FOL_IMG,"",boolean nohtml,false,boolean dir_view,true,if,request getParameter,"file",,null,,File f,new File,request getParameter,"file",if,isAllowed,f,,request setAttribute,"dir",f getParent,request setAttribute,"error","You are not allowed to access ",f getAbsolutePath,else if,f exists,,f canRead,,if,isPacked,f getName,false,,else,String mimeType,getMimeType,f getName,response setContentType,mimeType,if,mimeType equals,"text,plain",response setHeader,"Content,Disposition","inline,filename,"temp txt,"",else response setHeader,"Content,Disposition","inline,filename,"",f getName,,","",BufferedInputStream fileInput,new BufferedInputStream,new FileInputStream,f,byte buffer,,new byte,8,1024,out clearBuffer,OutputStream out_s,new Writer2Stream,out,copyStreamsWithoutClose,fileInput,out_s,buffer,fileInput close,out_s flush,nohtml,true,dir_view,false,else,request setAttribute,"dir",f getParent,request setAttribute,"error","File ",f getAbsolutePath," does not exist or is not readable on the server",else if,request getParameter,"Submit",,null,,request getParameter,"Submit", equals,SAVE_AS_ZIP,,Vector v,expandFileList,request getParameterValues,"selfile",false,String notAllowedFile,null,for,int i,0,i,v size,i,File f,,File,v get,i,if,isAllowed,f,notAllowedFile,f getAbsolutePath,break,if,notAllowedFile,null,request setAttribute,"error","You are not allowed to access']
    toy = Bert_Class()
    predict_result = []
    for t in testcase:
        aaa = time.clock()
        predict_result.append((toy.predict_on_ckpt(t), t))

        bbb = time.clock()
        print('ckpt预测用时：', bbb - aaa)
    for result, words in predict_result:
        print(result, words)
    # aaa = time.clock()
    # for t in testcase:
    #     toy.predict_on_pb(t)
    # bbb = time.clock()
    # print('pb模型预测用时：', bbb - aaa)
